<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Martin R. Smith" />

<meta name="date" content="2019-03-21" />

<title>Tree Search With Profile Parsimony</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceLine, a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
div.sourceLine, a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource div.sourceLine, .numberSource a.sourceLine
  { position: relative; }
pre.numberSource div.sourceLine::before, .numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em; }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; color: #aaaaaa;  padding-left: 4px; }
@media screen {
a.sourceLine::before { text-decoration: underline; color = initial; }
}
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.bn { color: #40a070; } /* BaseN */
code span.fl { color: #40a070; } /* Float */
code span.ch { color: #4070a0; } /* Char */
code span.st { color: #4070a0; } /* String */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.ot { color: #007020; } /* Other */
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.fu { color: #06287e; } /* Function */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #880000; } /* Constant */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.ss { color: #bb6688; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #19177c; } /* Variable */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.op { color: #666666; } /* Operator */
code span.bu { } /* BuiltIn */
code span.ex { } /* Extension */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.at { color: #7d9029; } /* Attribute */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Tree Search With Profile Parsimony</h1>
<h4 class="author"><em>Martin R. Smith</em></h4>
<h4 class="date"><em>2019-03-21</em></h4>



<p><code>TreeSearch</code> is an R package that allows, among other things, parsimony search on morphological datasets using the Profile Parsimony optimality criterion of Faith &amp; Trueman <span class="citation">(2001)</span>.</p>
<p>Profile Parsimony finds the tree that is most faithful to the information contained within a given dataset.</p>
<p>Character data are read from a restricted NEXUS format using the R function <code>ape::read.nexus.data</code>; see the latter function’s documentation for details.</p>
<p>NEXUS files can be edited in any standard text editor, for example <a href="https://notepad-plus-plus.org">Notepad++</a>.</p>
<p>A notable limitation is that the parser cannot interpret curly braces, for example <code>{01}</code>.<br />
Ambiguous tokens of this nature should be replaced with a separate character, for example ‘A’ to denote <code>{01}</code>, ‘B’ to denote <code>{12}</code>, perhaps using a search-and-replace operation in your favourite text editor.</p>
<ul>
<li><h1 id="todo">TODO!</h1></li>
<li>Also possible to use TreeSearch <code>ReadNexusData</code>..!</li>
</ul>
<p>This said, the Profile Parsimony algorithm is currently implemented only for binary characters with no ambiguous tokens. I hope to address this limitation soon.</p>
<div id="loading-the-package" class="section level2">
<h2>Loading the package</h2>
<p>To install the package for the first time, type</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">'TreeSearch'</span>)</div></code></pre>
<p>Once the package has been installed, load it using</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">library</span>(<span class="st">'TreeSearch'</span>)</div></code></pre>
</div>
<div id="loading-data-into-the-package" class="section level2">
<h2>Loading data into the package</h2>
<p>To use this script on your own data, launch R, and type (or copy-paste) the following text into the R console. Lines starting with ‘#’ are comments and do not need to be copied.</p>
<p>Data can be read from a nexus file (note the restrictions detailed above):</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">my.data &lt;-<span class="st"> </span><span class="kw">read.nexus.data</span>(<span class="st">'C:/path/to/filename.nex'</span>)</div></code></pre>
<p>Alternatively you can use a built-in dataset:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">data</span>(congreveLamsdellMatrices)</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2">my.data &lt;-<span class="st"> </span>congreveLamsdellMatrices[[<span class="dv">10</span>]]</div></code></pre>
<p>A contrast matrix translates the tokens used in your dataset to the character states to which they correspond: for example decoding ‘A’ to {01}. For more details, see the ‘phangorn-specials’ vignette in the phangorn package, accessible by typing ‘?phangorn’ in the R prompt and navigating to index &gt; package vignettes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">contrast.matrix &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">data=</span><span class="kw">c</span>(</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="co"># 0 1 -  # Each column corresponds to a character-state</span></div>
<div class="sourceLine" id="3" href="#3" data-line-number="3">  <span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>, <span class="co"># Each row corresponds to a token, here 0, denoting the character-state set {0} </span></div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">  <span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="co"># 1 | {1}</span></div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">  <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>, <span class="co"># - | {-}</span></div>
<div class="sourceLine" id="6" href="#6" data-line-number="6">  <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="co"># A | {01}</span></div>
<div class="sourceLine" id="7" href="#7" data-line-number="7">  <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="co"># + | {01}</span></div>
<div class="sourceLine" id="8" href="#8" data-line-number="8">  <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>  <span class="co"># ? | {01-}</span></div>
<div class="sourceLine" id="9" href="#9" data-line-number="9">), <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>); <span class="co"># ncol should correspond to the number of columns in the matrix</span></div>
<div class="sourceLine" id="10" href="#10" data-line-number="10"><span class="kw">dimnames</span>(contrast.matrix) &lt;-<span class="st"> </span><span class="kw">list</span>(</div>
<div class="sourceLine" id="11" href="#11" data-line-number="11">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="st">'-'</span>, <span class="st">'A'</span>, <span class="st">'+'</span>, <span class="st">'?'</span>), <span class="co"># A list of the tokens corresponding to each row</span></div>
<div class="sourceLine" id="12" href="#12" data-line-number="12">                               <span class="co"># in the contrast matrix</span></div>
<div class="sourceLine" id="13" href="#13" data-line-number="13">  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="st">'-'</span>) <span class="co"># A list of the character-states corresponding to the columns </span></div>
<div class="sourceLine" id="14" href="#14" data-line-number="14">               <span class="co"># in the contrast matrix</span></div>
<div class="sourceLine" id="15" href="#15" data-line-number="15">)</div>
<div class="sourceLine" id="16" href="#16" data-line-number="16"></div>
<div class="sourceLine" id="17" href="#17" data-line-number="17">contrast.matrix</div></code></pre>
<pre><code>##   0 1 -
## 0 1 0 0
## 1 0 1 0
## - 0 0 1
## A 1 1 0
## + 1 1 0
## ? 1 1 1</code></pre>
<p>If you need to use a contrast matrix, convert the data using</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">my.phyDat &lt;-<span class="st"> </span><span class="kw">phyDat</span>(my.data, <span class="dt">type=</span><span class="st">'USER'</span>, <span class="dt">contrast=</span>contrast.matrix)</div></code></pre>
<p>We don’t have any such ambiguities in our dataset, so we can go straight in with</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">my.phyDat &lt;-<span class="st"> </span>phangorn<span class="op">::</span><span class="kw">phyDat</span>(my.data, <span class="dt">type=</span><span class="st">'USER'</span>, <span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</div></code></pre>
<p>We then need to prepare our dataset for Profile Parsimony by calculating the information loss implied by each additional step in each character. Ideally we’d pick a high value of precision (&gt; 1e+06): this takes a while, but only needs doing once for each dataset of a given size.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">my.prepdata &lt;-<span class="st"> </span><span class="kw">PrepareDataProfile</span>(my.phyDat, <span class="dt">precision=</span><span class="fl">4e+04</span>)</div></code></pre>
<p>To start analysis, we need to load a starting tree. We can do this at random:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">suppressWarnings</span>(<span class="kw">RNGversion</span>(<span class="st">&quot;3.5.0&quot;</span>)) <span class="co"># Until we can require R3.6.0</span></div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">888</span>)</div>
<div class="sourceLine" id="3" href="#3" data-line-number="3">tree &lt;-<span class="st"> </span><span class="kw">RandomTree</span>(my.phyDat)</div></code></pre>
<p>Or using a neighbour joining method, to start at a reasonably good tree:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">tree &lt;-<span class="st"> </span><span class="kw">NJTree</span>(my.phyDat)</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></div>
<div class="sourceLine" id="3" href="#3" data-line-number="3"><span class="kw">plot</span>(tree)</div></code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Calculate the tree’s parsimony score:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">ProfileScore</span>(tree, my.prepdata)</div></code></pre>
<pre><code>## [1] -282.6696</code></pre>
<p>Search for a better tree:</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">better.tree &lt;-<span class="st"> </span><span class="kw">ProfileTreeSearch</span>(ape<span class="op">::</span><span class="kw">root</span>(tree, <span class="st">'1'</span>, <span class="dt">resolve.root=</span><span class="ot">TRUE</span>), my.prepdata, <span class="dt">EdgeSwapper=</span>RootedTBRSwap)</div></code></pre>
<pre><code>## 
##   - Performing tree search.  Initial score: -282.6696
##   - Final score -285.049 found 2 times after 100 rearrangements</code></pre>
<p>The parsimony ratchet <span class="citation">(Nixon, 1999)</span> is better at finding globally optimal trees. <code>ProfileRatchet</code> is a convenient wrapper for the underlying function <code>Ratchet</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="co"># Longwinded approach:</span></div>
<div class="sourceLine" id="2" href="#2" data-line-number="2">better.tree &lt;-<span class="st"> </span><span class="kw">Ratchet</span>(better.tree, my.prepdata, <span class="dt">searchHits=</span><span class="dv">10</span>, <span class="dt">searchIter=</span><span class="dv">100</span>, <span class="dt">ratchIter=</span><span class="dv">5</span>,</div>
<div class="sourceLine" id="3" href="#3" data-line-number="3">                       <span class="dt">swappers=</span><span class="kw">list</span>(RootedTBRSwap, RootedSPRSwap, RootedNNISwap),</div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">                       <span class="dt">InitializeData=</span>ProfileInitMorphy, <span class="dt">CleanUpData=</span>ProfileDestroyMorphy,</div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">                       <span class="dt">TreeScorer=</span>ProfileScoreMorphy, <span class="dt">Bootstrapper=</span>ProfileBootstrap)</div></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="co"># Less typing!</span></div>
<div class="sourceLine" id="2" href="#2" data-line-number="2">RootedSwappers &lt;-<span class="st"> </span><span class="kw">list</span>(RootedTBRSwap, RootedSPRSwap, RootedNNISwap)</div>
<div class="sourceLine" id="3" href="#3" data-line-number="3">better.tree &lt;-<span class="st"> </span><span class="kw">ProfileRatchet</span>(better.tree, my.prepdata,</div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">                              <span class="dt">swappers=</span>RootedSwappers,</div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">                              <span class="dt">searchHits=</span><span class="dv">10</span>, <span class="dt">searchIter=</span><span class="dv">100</span>, <span class="dt">ratchIter=</span><span class="dv">5</span>)</div></code></pre>
<pre><code>## 
## * Beginning Parsimony Ratchet, with initial score -285.049
## Completed parsimony ratchet after 5 iterations with score -311.9414</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.25</span>, <span class="dv">4</span>), <span class="dt">cex=</span><span class="fl">0.75</span>) <span class="co"># make plot easier to read</span></div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(better.tree)</div></code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The default parameters may not be enough to find the optimal tree; type <code>?Ratchet</code> to view all search parameters.</p>
</div>
<div id="view-the-results" class="section level2">
<h2>View the results</h2>
<p>In parsimony search, it is generally good practice to consider trees that are slightly suboptimal. Here, we’ll take a consensus that includes all trees that are suboptimal by up to 1.5 bits. To sample this region of tree space well, the trick is to use large values of <code>ratchHits</code> and <code>ratchIter</code>, and small values of <code>searchHits</code> and <code>searchiter</code>, so that many runs don’t quite hit the optimal tree. In a serious study, you would want to sample many more than 25 Ratchet hits (<code>ratchHits</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1">suboptimals &lt;-<span class="st"> </span><span class="kw">ProfileRatchet</span>(better.tree, my.prepdata, </div>
<div class="sourceLine" id="2" href="#2" data-line-number="2">                              <span class="dt">swappers=</span><span class="kw">list</span>(RootedTBRSwap),</div>
<div class="sourceLine" id="3" href="#3" data-line-number="3">                              <span class="dt">returnAll=</span><span class="ot">TRUE</span>, <span class="dt">suboptimal=</span><span class="dv">5</span>, </div>
<div class="sourceLine" id="4" href="#4" data-line-number="4">                              <span class="dt">ratchHits=</span><span class="dv">25</span>, <span class="dt">ratchIter=</span><span class="dv">5000</span>, </div>
<div class="sourceLine" id="5" href="#5" data-line-number="5">                              <span class="dt">bootstrapHits=</span><span class="dv">15</span>, <span class="dt">bootstrapIter=</span><span class="dv">450</span>,</div>
<div class="sourceLine" id="6" href="#6" data-line-number="6">                              <span class="dt">searchHits=</span><span class="dv">10</span>, <span class="dt">searchIter=</span><span class="dv">50</span>)</div></code></pre>
<pre><code>## 
## * Beginning Parsimony Ratchet, with initial score -311.9414
## Completed parsimony ratchet after 68 iterations with score -313.0414 
## 
## Found 1 unique MPTs and 7 suboptimal trees.</code></pre>
<p>Let’s calculate and display a consensus tree that includes slightly suboptimal trees.</p>
<pre class="sourceCode r"><code class="sourceCode r"><div class="sourceLine" id="1" href="#1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="fl">0.2</span>, <span class="dv">4</span>))</div>
<div class="sourceLine" id="2" href="#2" data-line-number="2"><span class="kw">plot</span>(my.consensus &lt;-<span class="st"> </span>ape<span class="op">::</span><span class="kw">consensus</span>(suboptimals))</div></code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-Faith2001">
<p>Faith, D. P., &amp; Trueman, J. W. H. (2001). Towards an inclusive philosophy for phylogenetic inference. <em>Systematic Biology</em>, <em>50</em>(3), 331–350. doi:<a href="https://doi.org/10.1080/10635150118627">10.1080/10635150118627</a></p>
</div>
<div id="ref-Nixon1999">
<p>Nixon, K. C. (1999). The Parsimony Ratchet, a new method for rapid parsimony analysis. <em>Cladistics</em>, <em>15</em>(4), 407–414. doi:<a href="https://doi.org/10.1111/j.1096-0031.1999.tb00277.x">10.1111/j.1096-0031.1999.tb00277.x</a></p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
